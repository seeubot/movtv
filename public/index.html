<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Media Library</title>
    <style>
        body { font-family: sans-serif; margin: 0; background-color: #f0f2f5; color: #333; }
        .container { max-width: 1200px; margin: 20px auto; padding: 20px; background: #fff; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        h1, h2 { color: #1a237e; }
        #search-container { margin-bottom: 20px; display: flex; gap: 10px; }
        #search-input { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; font-size: 16px; }
        #search-button { padding: 10px 20px; border: none; background-color: #3f51b5; color: white; border-radius: 4px; cursor: pointer; }
        #search-button:hover { background-color: #303f9f; }
        #media-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px; }
        .media-card { background: #fafafa; border: 1px solid #eee; border-radius: 8px; overflow: hidden; text-align: center; transition: transform 0.2s; cursor: pointer; }
        .media-card:hover { transform: translateY(-5px); box-shadow: 0 6px 10px rgba(0,0,0,0.15); }
        .media-card img { width: 100%; height: 300px; object-fit: cover; }
        .media-card h3 { font-size: 1.1em; margin: 10px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .media-type { font-size: 0.8em; color: #777; margin-bottom: 5px; }
        #modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.4); }
        .modal-content { background-color: #fff; margin: 15% auto; padding: 20px; border: 1px solid #888; width: 80%; max-width: 600px; border-radius: 8px; position: relative; }
        .close-button { color: #aaa; float: right; font-size: 28px; font-weight: bold; cursor: pointer; }
        .close-button:hover { color: black; }
        .episode-list { list-style: none; padding: 0; }
        .episode-list li { background: #eee; padding: 10px; margin-bottom: 5px; border-radius: 4px; }
    </style>
</head>
<body>

    <div class="container">
        <h1>üé¨ My Media Library üì∫</h1>
        <div id="search-container">
            <input type="text" id="search-input" placeholder="Search for movies or series...">
            <button id="search-button">Search</button>
        </div>
        <div id="media-list"></div>
    </div>

    <div id="modal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <div id="modal-details"></div>
        </div>
    </div>

    <script>
        const API_BASE_URL = 'https://comparable-cornela-seeutech-95c15254.koyeb.app/api'; // Replace with your actual Koyeb URL

        document.addEventListener('DOMContentLoaded', () => {
            const searchInput = document.getElementById('search-input');
            const searchButton = document.getElementById('search-button');
            const mediaList = document.getElementById('media-list');
            const modal = document.getElementById('modal');
            const modalDetails = document.getElementById('modal-details');
            const closeButton = document.querySelector('.close-button');

            // Event listener for search button
            searchButton.addEventListener('click', () => {
                fetchMedia(searchInput.value);
            });

            // Event listener for Enter key in search box
            searchInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    fetchMedia(searchInput.value);
                }
            });

            // Fetch and display media
            async function fetchMedia(searchTerm = '') {
                mediaList.innerHTML = '<p>Loading...</p>';
                const url = `${API_BASE_URL}/media?search=${encodeURIComponent(searchTerm)}`;
                try {
                    const response = await fetch(url);
                    if (!response.ok) throw new Error('Network response was not ok');
                    const media = await response.json();
                    displayMedia(media);
                } catch (error) {
                    mediaList.innerHTML = '<p>Error loading media. Please try again later.</p>';
                    console.error('Error fetching media:', error);
                }
            }

            // Display media in cards
            function displayMedia(media) {
                mediaList.innerHTML = '';
                if (media.length === 0) {
                    mediaList.innerHTML = '<p>No media found.</p>';
                    return;
                }
                media.forEach(item => {
                    const card = document.createElement('div');
                    card.className = 'media-card';
                    card.innerHTML = `
                        <img src="${item.thumbnail}" alt="${item.name}">
                        <h3>${item.name}</h3>
                        <p class="media-type">${item.type === 'movie' ? 'Movie' : 'Series'}</p>
                    `;
                    card.addEventListener('click', () => showDetails(item));
                    mediaList.appendChild(card);
                });
            }

            // Show details in modal
            function showDetails(item) {
                modalDetails.innerHTML = `
                    <h2>${item.name}</h2>
                    <img src="${item.thumbnail}" alt="${item.name}" style="width:100%; height:auto; border-radius:4px; margin-bottom: 15px;">
                `;

                if (item.type === 'movie') {
                    modalDetails.innerHTML += `
                        <p><strong>Type:</strong> Movie</p>
                        <a href="${item.streamingUrl}" target="_blank">üîó Watch Now</a>
                    `;
                } else if (item.type === 'series') {
                    // This assumes the series object already has episodes embedded from the new API endpoint
                    const episodesHtml = item.episodes.map(ep => `
                        <li>
                            <strong>S${ep.seasonNumber}E${ep.episodeNumber}:</strong> ${ep.title}
                            <a href="${ep.streamingUrl}" target="_blank">‚ñ∂Ô∏è Watch</a>
                        </li>
                    `).join('');
                    modalDetails.innerHTML += `
                        <p><strong>Type:</strong> Series</p>
                        <h3>Episodes:</h3>
                        <ul class="episode-list">${episodesHtml}</ul>
                    `;
                }

                modal.style.display = 'block';
            }

            // Close modal
            closeButton.addEventListener('click', () => {
                modal.style.display = 'none';
            });

            window.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.style.display = 'none';
                }
            });

            // Initial fetch
            fetchMedia();
        });
    </script>
</body>
</html>
