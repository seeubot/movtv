<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Media Manager</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Custom styles for a cleaner look -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .tab-button {
            transition: color 0.2s, border-color 0.2s;
        }
        .media-card {
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .media-card:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-200 min-h-screen">

    <div class="container mx-auto p-4 md:p-8">

        <!-- Header Section -->
        <header class="flex flex-col md:flex-row items-center justify-between pb-8 border-b border-gray-700 mb-8">
            <h1 class="text-4xl font-extrabold text-white">Media Manager</h1>
            <div id="stats-container" class="flex items-center space-x-4 mt-4 md:mt-0">
                <!-- Stats will be dynamically injected here by JavaScript -->
            </div>
        </header>

        <!-- Navigation Tabs -->
        <div class="flex space-x-4 mb-8 border-b border-gray-700">
            <button id="movies-tab" class="tab-button py-2 px-4 text-lg font-medium text-white border-b-2 border-teal-400">Movies</button>
            <button id="series-tab" class="tab-button py-2 px-4 text-lg font-medium text-gray-400 hover:text-gray-200">Series</button>
        </div>

        <!-- Main Content Area -->
        <div id="content-area">
            <!-- Loading and Error messages -->
            <div id="loading-message" class="flex items-center justify-center py-12">
                <p class="text-xl font-medium">Loading data...</p>
            </div>

            <div id="error-message" class="hidden text-center text-red-400 p-4 text-xl">
                <p>Failed to fetch data from the API. Please check if the backend is running.</p>
            </div>

            <!-- Media content will be rendered here by JavaScript -->
            <div id="media-grid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6"></div>
        </div>

    </div>

    <!-- JavaScript for fetching data and rendering the UI -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Base URL for the backend API.
            const API_BASE_URL = 'https://future-ester-seeutech-645c6129.koyeb.app/api';

            // DOM elements
            const loadingMessage = document.getElementById('loading-message');
            const errorMessage = document.getElementById('error-message');
            const mediaGrid = document.getElementById('media-grid');
            const statsContainer = document.getElementById('stats-container');
            const moviesTab = document.getElementById('movies-tab');
            const seriesTab = document.getElementById('series-tab');

            // Store the fetched data
            let movies = [];
            let series = [];
            let stats = {};

            // Initial active tab
            let activeTab = 'movies';

            // Function to fetch data from all endpoints concurrently
            const fetchData = async () => {
                loadingMessage.classList.remove('hidden');
                errorMessage.classList.add('hidden');
                mediaGrid.innerHTML = '';

                try {
                    // Use Promise.all to make all three API calls at the same time
                    const [moviesResponse, seriesResponse, statsResponse] = await Promise.all([
                        fetch(`${API_BASE_URL}/movies`),
                        fetch(`${API_BASE_URL}/series`),
                        fetch(`${API_BASE_URL}/stats`)
                    ]);

                    // Check if responses are OK before parsing
                    if (!moviesResponse.ok || !seriesResponse.ok || !statsResponse.ok) {
                        throw new Error('One or more API responses were not successful.');
                    }

                    // Parse JSON data
                    movies = await moviesResponse.json();
                    series = await seriesResponse.json();
                    stats = await statsResponse.json();

                    // Render the initial content
                    updateStats();
                    renderContent();

                } catch (e) {
                    console.error("Failed to fetch data:", e);
                    errorMessage.classList.remove('hidden');
                } finally {
                    // Hide loading message once all operations are complete
                    loadingMessage.classList.add('hidden');
                }
            };

            // Function to update the stats in the header
            const updateStats = () => {
                statsContainer.innerHTML = `
                    <div class="flex flex-col items-center">
                        <span class="text-2xl font-bold text-teal-400">${stats.movies}</span>
                        <span class="text-sm text-gray-400">Movies</span>
                    </div>
                    <div class="flex flex-col items-center">
                        <span class="text-2xl font-bold text-purple-400">${stats.series}</span>
                        <span class="text-sm text-gray-400">Series</span>
                    </div>
                    <div class="flex flex-col items-center">
                        <span class="text-2xl font-bold text-orange-400">${stats.episodes}</span>
                        <span class="text-sm text-gray-400">Episodes</span>
                    </div>
                `;
            };

            // Function to render a single media card element
            const createMediaCard = (item, type) => {
                const card = document.createElement('div');
                card.className = 'media-card relative w-full overflow-hidden bg-gray-800 rounded-2xl shadow-xl';

                const thumbnail = item.thumbnail || 'https://placehold.co/400x600/1f2937/d1d5db?text=No+Image';
                const seasonsInfo = type === 'series' && item.seasons
                    ? `<p class="text-sm text-gray-400 mt-1">${item.seasons.length} ${item.seasons.length > 1 ? 'seasons' : 'season'}</p>`
                    : '';

                card.innerHTML = `
                    <img src="${thumbnail}" alt="${item.name}" class="w-full h-80 object-cover" onerror="this.onerror=null;this.src='https://placehold.co/400x600/1f2937/d1d5db?text=No+Image';">
                    <div class="p-4">
                        <h3 class="text-lg font-semibold text-white truncate">${item.name}</h3>
                        ${seasonsInfo}
                    </div>
                `;
                return card;
            };

            // Function to render the media content based on the active tab
            const renderContent = () => {
                mediaGrid.innerHTML = ''; // Clear previous content

                const dataToRender = activeTab === 'movies' ? movies : series;
                const type = activeTab === 'movies' ? 'movie' : 'series';
                const emptyMessage = `
                    <div class="col-span-full text-center text-gray-500 text-lg py-12">
                        No ${activeTab} found. Add some from the Telegram bot!
                    </div>
                `;

                if (dataToRender.length > 0) {
                    dataToRender.forEach(item => {
                        const card = createMediaCard(item, type);
                        mediaGrid.appendChild(card);
                    });
                } else {
                    mediaGrid.innerHTML = emptyMessage;
                }
            };

            // Function to handle tab switching
            const switchTab = (tab) => {
                activeTab = tab;
                if (tab === 'movies') {
                    moviesTab.classList.add('text-white', 'border-b-2', 'border-teal-400');
                    seriesTab.classList.remove('text-white', 'border-b-2', 'border-purple-400');
                    seriesTab.classList.add('text-gray-400', 'hover:text-gray-200');
                } else {
                    seriesTab.classList.add('text-white', 'border-b-2', 'border-purple-400');
                    moviesTab.classList.remove('text-white', 'border-b-2', 'border-teal-400');
                    moviesTab.classList.add('text-gray-400', 'hover:text-gray-200');
                }
                renderContent();
            };

            // Add event listeners for the tabs
            moviesTab.addEventListener('click', () => switchTab('movies'));
            seriesTab.addEventListener('click', () => switchTab('series'));

            // Initial data fetch
            fetchData();
        });
    </script>
</body>
</html>
